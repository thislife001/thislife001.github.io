<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>bonding</title>
      <link href="/2018/09/14/bonding/"/>
      <url>/2018/09/14/bonding/</url>
      <content type="html"><![CDATA[<p>一、bonding技术：<br>bonding(绑定)是一种linux系统下的网卡绑定技术，可以把服务器上n个物理网卡在系统内部抽象(绑定)成一个逻辑上的网卡，能够提升网络吞吐量、实现网络冗余、负载等功能，有很多优势。</p><p>bonding技术是linux系统内核层面实现的，它是一个内核模块(驱动)。使用它需要系统有这个模块, 我们可以modinfo命令查看下这个模块的信息, 一般来说都支持.<br>bonding的七种工作模式:<br><a id="more"></a><br>bonding技术提供了七种工作模式，在使用的时候需要指定一种，每种有各自的优缺点.<br>    <figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>balance-rr (mode=<span class="number">0</span>)       默认, 有高可用 (容错) 和负载均衡的功能,  需要交换机的配置，每块网卡轮询发包 (流量分发比较均衡);</span><br><span class="line"><span class="number">2.</span>active-backup (mode=<span class="number">1</span>)  只有高可用 (容错) 功能, 不需要交换机配置, 这种模式只有一块网卡工作, 对外只有一个mac地址。缺点是端口利用率比较低;</span><br><span class="line"><span class="number">3.</span>balance-xor (mode=<span class="number">2</span>)     不常用;</span><br><span class="line"><span class="number">4.</span>broadcast (mode=<span class="number">3</span>)        不常用;</span><br><span class="line"><span class="number">5.802</span><span class="number">.3</span>ad (mode=<span class="number">4</span>)          IEEE <span class="number">802.3</span>ad 动态链路聚合，需要交换机配置，没用过;</span><br><span class="line"><span class="number">6.</span>balance-tlb (mode=<span class="number">5</span>)      不常用;</span><br><span class="line"><span class="number">7.</span>balance-alb (mode=<span class="number">6</span>)     有高可用 ( 容错 )和负载均衡的功能，不需要交换机配置  (流量分发到每个接口不是特别均衡);</span><br></pre></td></tr></table></figure></p><p>具体的网上有很多资料，了解每种模式的特点根据自己的选择就行, 一般会用到0、1、4、6这几种模式。<br>二、Centos 7配置bonding:<br>环境：<br>    <figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">系统：Centos <span class="number">7.4</span>；</span><br><span class="line">网卡：em1,em3；</span><br><span class="line"><span class="symbol">mode:</span> <span class="number">1</span>(主备)；</span><br><span class="line">`</span><br></pre></td></tr></table></figure></p><p>1.在/etc/sysconfig/network-scripts下新建ifcfg-bond0<br>    <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[localadmin@zabbix network-scripts]</span><span class="comment"># vim ifcfg-bond0</span></span><br><span class="line"><span class="attr">DEVICE</span>=bond0</span><br><span class="line"><span class="attr">TYPE</span>=Bond</span><br><span class="line"><span class="attr">IPADDR</span>=#ip地址</span><br><span class="line"><span class="attr">NETMASK</span>=#子网掩码</span><br><span class="line"><span class="attr">GATEWAY</span>=#网关</span><br><span class="line"><span class="attr">USERCTL</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">BOOTPROTO</span>=none</span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span></span><br></pre></td></tr></table></figure></p><p>2.编辑ifcfg-em1<br>    <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[localadmin@zabbix network-scripts]</span><span class="comment"># vim ifcfg-em1</span></span><br><span class="line"><span class="attr">TYPE</span>=Ethernet</span><br><span class="line"><span class="attr">PROXY_METHOD</span>=none</span><br><span class="line"><span class="attr">BROWSER_ONLY</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">BOOTPROTO</span>=none#dhcp改为none</span><br><span class="line"><span class="attr">DEFROUTE</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">IPV4_FAILURE_FATAL</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">IPV6INIT</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">IPV6_AUTOCONF</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">IPV6_DEFROUTE</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">IPV6_FAILURE_FATAL</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">IPV6_ADDR_GEN_MODE</span>=stable-privacy</span><br><span class="line"><span class="attr">NAME</span>=em1</span><br><span class="line"><span class="attr">DEVICE</span>=em1</span><br><span class="line"><span class="attr">ONBOOT</span>=<span class="literal">yes</span>#<span class="literal">no</span>改为<span class="literal">yes</span></span><br><span class="line"><span class="attr">MASTER</span>=bond0</span><br><span class="line"><span class="attr">USERCTL</span>=<span class="literal">no</span></span><br><span class="line"><span class="attr">SLAVE</span>=<span class="literal">yes</span></span><br></pre></td></tr></table></figure></p><p>3.em3和em1相同：<br>4.在/etc/modprobe.d下新建bonding.conf<br>    <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[localadmin@zabbix modprobe.d]$</span><br><span class="line">alias bond0 bonding</span><br><span class="line">options bond0 <span class="attribute">mode</span>=1 <span class="attribute">miimon</span>=100</span><br></pre></td></tr></table></figure></p><p>5.测试方法：<br>    <figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[localadmin@zabbix modprobe.d]$ nmcli con show</span><br><span class="line">NAME        UUID                                  TYPE            DEVICE </span><br><span class="line">Bond bond0  ad33d8b0<span class="number">-1</span>f7b-cab9<span class="number">-9447</span>-ba07f855b143  bond            bond0  </span><br><span class="line">em1         <span class="number">1</span>dad842d<span class="number">-1912</span>-ef5a-a43a-bc238fb267e7  <span class="number">802</span><span class="number">-3</span>-ethernet  em1    </span><br><span class="line">em3         <span class="number">6</span>b2b49df-c30e<span class="number">-4</span>cd6<span class="number">-807</span>c<span class="number">-805</span>d367f2caf  <span class="number">802</span><span class="number">-3</span>-ethernet  em3    </span><br><span class="line">em2         da2824cc-bbce<span class="number">-444</span>a-b129<span class="number">-04</span>f5f6959482  <span class="number">802</span><span class="number">-3</span>-ethernet  --     </span><br><span class="line">em4         <span class="number">41</span>b7896a-ed2b<span class="number">-467</span>e-a9de<span class="number">-564065315758</span>  <span class="number">802</span><span class="number">-3</span>-ethernet  --</span><br></pre></td></tr></table></figure></p><p>直接插拔网线也可以~方法很多！！！</p>]]></content>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>使用kubeadm部署kubernetes</title>
      <link href="/2018/09/14/kubernetes/"/>
      <url>/2018/09/14/kubernetes/</url>
      <content type="html"><![CDATA[<p>本次介绍使用kubeadm部署kubernetes集群<br>环境介绍：<br>    1.准备3台服务器（本实验使用虚拟机）一个master，两个node；<br>    2.各节点主机名称解析：DNS或者hosts（本人hosts）；<br>    3.各节点iptables及firewalld服务disable；<br>    4.各节点时间同步；<br>    5.配置master和node的免密登陆；<br>一、配置kubernetes及docker的yum仓库(master和node都需要配置)：<br>    1.docker仓库配置；<br>    <figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# wget -P <span class="regexp">/etc/yum</span>.repos.d<span class="regexp">/ https:/</span><span class="regexp">/mirrors.aliyun.com/</span>docker-ce<span class="regexp">/linux/</span>centos<span class="regexp">/docker-ce.repo</span></span><br></pre></td></tr></table></figure></p><a id="more"></a><p>2.kubernetes仓库配置：<br>在/etc/yum.repos.d下创建kubernetes.repo文件，编辑添加如下内容：<br>    <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[root@master ~]</span><span class="comment"># vim /etc/yum.repos.d/kubernetes.repo </span></span><br><span class="line"><span class="attr">name</span>=Kubernetes Repo</span><br><span class="line"><span class="attr">baseurl</span>=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x<span class="number">86_64</span>/</span><br><span class="line"><span class="attr">gpgcheck</span>=<span class="number">0</span></span><br><span class="line"><span class="attr">gpgkey</span>=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br><span class="line"><span class="attr">enabled</span>=<span class="number">1</span></span><br></pre></td></tr></table></figure></p><p>二、安装master程序包：<br>    <figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# yum</span> install docker-ce kubelet kubectl kubeadm -y</span><br></pre></td></tr></table></figure></p><p>三、初始化master节点：<br>1.配置docker Unit File中的Environment变量，定义HTTPS_PROXY和NO_PROXY（/usr/lib/systemd/system/docker.service）<br>    <figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# vim</span> /usr/lib/systemd/system/docker.service</span><br><span class="line"><span class="attr">Environment=</span><span class="string">"HTTPS_PROXY=http://www.ik8s.io:10080"</span></span><br><span class="line"><span class="attr">Environment=</span><span class="string">"NO_PROXY=127.0.0.0/8,172.20.0.0/16"</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# systemctl</span> daemon-reload</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# systemctl</span> <span class="literal">start</span> docker.service</span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# systemctl</span> enable docker.service</span><br></pre></td></tr></table></figure></p><p>2.编辑kubelet的配置文件/etc/sysconfig/kubelet,设置忽略Swap启用状态错误提示，内容如下：<br>    <figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# cat</span> /etc/sysconfig/kubelet </span><br><span class="line"><span class="attr">KUBELET_EXTRA_ARGS=</span><span class="string">"--fail-swap-on=false"</span></span><br><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# systemctl</span> enable kubelet</span><br></pre></td></tr></table></figure></p><p>3.初始化master节点：<br>    <figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubeadm init --kubernetes-version=v1<span class="number">.11</span><span class="number">.2</span> --pod-network-cidr=<span class="number">10.244</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">16</span> --service-cidr=<span class="number">10.96</span><span class="number">.0</span><span class="number">.0</span>/<span class="number">12</span> --ignore-preflight-errors=Swap</span><br></pre></td></tr></table></figure></p><p>注：参数解释<br>    –kubernetes-version         kubernetes的版本，我这里是v1.11.2；<br>    –pod-network-cidr             pod的网络；<br>    –service-cidr                 service的网络；<br>    –ignore-preflight-errors    要忽略的错误，我这里忽略Swap错误；<br>注意：初始化会pull镜像，初始化的时间长短根据实际网络状况决定；<br>      初始化完成后，请记录kubeadm join的全部内容，后面加节点使用；</p><p>5.初始化kubectl:<br>    <figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# mkdir -p <span class="variable">$HOME</span>/.kube</span><br><span class="line">[root@master ~]# cp -i /etc/kubernetes/admin.conf <span class="variable">$HOME</span>/.kube/config</span><br><span class="line">[root@master ~]# chown $(id -u):$(id -g) <span class="variable">$HOME</span>/.kube/config</span><br></pre></td></tr></table></figure></p><p>6.添加flannel网络附件：<br>    <figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@<span class="keyword">master</span> <span class="title">~]# kubectl</span> apply -f https://raw.githubusercontent.com/coreos/flannel/<span class="literal">master</span>/Documentation/kube-flannel.yml</span><br></pre></td></tr></table></figure></p><p>7.验证master节点是否就绪：<br>    <figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@<span class="keyword">master</span> <span class="title">~]# kubectl</span> get nodes</span><br><span class="line">NAME      STATUS    ROLES     AGE       <span class="keyword">VERSION</span></span><br><span class="line"><span class="keyword">master</span>    <span class="title">Ready</span>     <span class="keyword">master</span>    <span class="title">3d</span>        v1.<span class="number">11.2</span></span><br></pre></td></tr></table></figure></p><p>四、初始化node节点(node01和node02操作相同)：<br>1.设置dokcer及kubernetes的仓库和master相同；<br>2.安装软件包:<br>    <figure class="highlight autoit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root<span class="symbol">@node01</span> ~]<span class="meta"># yum install docker-ce kubelet kubeadm</span></span><br></pre></td></tr></table></figure></p><p>3.配置docker Unit File和kubelet和master相同操作；<br>4.设置docker和kubelet开机启动和master相同操作；<br>5.将节点加入master中：<br>    <figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">kubeadm</span> <span class="comment">join</span> <span class="comment">192</span><span class="string">.</span><span class="comment">168</span><span class="string">.</span><span class="comment">0</span><span class="string">.</span><span class="comment">200:6443</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">token</span> <span class="comment">ddqen4</span><span class="string">.</span><span class="comment">ioh8yqmy8xogd4od</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">discovery</span><span class="literal">-</span><span class="comment">token</span><span class="literal">-</span><span class="comment">ca</span><span class="literal">-</span><span class="comment">cert</span><span class="literal">-</span><span class="comment">hash</span> <span class="comment">sha256:1a707fa28d13adee881f39e3b240040be54fb00db08be1956db2907b500bcf06</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">ignore</span><span class="literal">-</span><span class="comment">preflight</span><span class="literal">-</span><span class="comment">errors=Swap</span></span><br></pre></td></tr></table></figure></p><p>注：上面的token是我的，这各值为master初始化完成后让记录的那个值；<br>6.在master上验证是否加入成功：<br>    <figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@<span class="keyword">master</span> <span class="title">~]# kubectl</span> get nodes</span><br><span class="line">NAME      STATUS    ROLES     AGE       <span class="keyword">VERSION</span></span><br><span class="line"><span class="keyword">master</span>    <span class="title">Ready</span>     <span class="keyword">master</span>    <span class="title">3d</span>        v1.<span class="number">11.2</span></span><br><span class="line">node01    Ready     <span class="tag">&lt;none&gt;</span>    <span class="number">3</span>d        v1.<span class="number">11.2</span></span><br><span class="line">node02    Ready     <span class="tag">&lt;none&gt;</span>    <span class="number">3</span>d        v1.<span class="number">11.2</span></span><br></pre></td></tr></table></figure></p><p>看到如上结果，那么恭喜你，你已经拥有一个kubernetes的集群了；</p>]]></content>
      
      
        <tags>
            
            <tag> kubernetes </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Zabbix Centos 7.4 Agent 安装脚本</title>
      <link href="/2018/09/14/zabbix/"/>
      <url>/2018/09/14/zabbix/</url>
      <content type="html"><![CDATA[<p>本章的脚本是自己工作中生产环境在Centos 7.4中安装zabbix client的shell脚本，配合ansible使用，仅供参考<br><a id="more"></a><br>1、脚本内容：<br><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">check_ok() &#123;</span><br><span class="line"><span class="keyword">if</span> [ $? != 0 ]</span><br><span class="line">then</span><br><span class="line">    echo <span class="string">"Error, Check the error log."</span></span><br><span class="line">    <span class="keyword">exit</span> 1</span><br><span class="line">fi</span><br><span class="line">&#125;</span><br><span class="line">zabbix_agentd_install() &#123;</span><br><span class="line">    PREFIX=/usr/<span class="keyword">local</span>/zabbix_agentd</span><br><span class="line">    HOSTNAME=`ifconfig bond0 | grep netmask |awk '&#123;<span class="keyword">print</span> <span class="variable">$2&#125;</span>'`</span><br><span class="line">    <span class="keyword">cd</span> /tmp/zabbix_tmp</span><br><span class="line">    check_ok</span><br><span class="line">    sudo tar -xzvf zabbix-3.4.12.tar.gz &gt;&gt;/tmp/zabbix_tmp/<span class="keyword">error</span>.<span class="built_in">log</span></span><br><span class="line">    check_ok</span><br><span class="line">    <span class="keyword">cd</span> zabbix-3.4.12</span><br><span class="line">    check_ok</span><br><span class="line">    sudo ./configure --prefix=<span class="variable">$PREFIX</span> --enable-agent &gt;&gt;/tmp/zabbix_tmp/<span class="keyword">error</span>.<span class="built_in">log</span></span><br><span class="line">    check_ok</span><br><span class="line">    sudo make</span><br><span class="line">    check_ok</span><br><span class="line">    sudo make install</span><br><span class="line">    check_ok</span><br><span class="line">    sudo cp /tmp/zabbix_tmp/zabbix-3.4.12/misc/init.<span class="keyword">d</span>/fedora/core/zabbix_agentd /etc/init.<span class="keyword">d</span>/</span><br><span class="line">    check_ok</span><br><span class="line">    sudo chmod +x /etc/init.<span class="keyword">d</span>/zabbix_agentd</span><br><span class="line">    check_ok</span><br><span class="line">    sudo sed -i 's/BASEDIR=\/usr\/<span class="keyword">local</span>/BASEDIR=\/usr\/<span class="keyword">local</span>\/zabbix_agentd/<span class="keyword">g</span>' /etc/init.<span class="keyword">d</span>/zabbix_agentd</span><br><span class="line">    check_ok</span><br><span class="line">    sudo sed -i 's/PIDFILE=\/tmp\/<span class="variable">$BINARY_NAME</span>.pid/PIDFILE=\/usr\/<span class="keyword">local</span>\/zabbix_agentd\/<span class="keyword">var</span>\/<span class="variable">$BINARY_NAME</span>.pid/<span class="keyword">g</span>' /etc/init.<span class="keyword">d</span>/zabbix_agentd</span><br><span class="line">    check_ok</span><br><span class="line">    sudo sed -i 's/# PidFile=\/tmp\/zabbix_agentd.pid/PidFile=\/usr\/<span class="keyword">local</span>\/zabbix_agentd\/<span class="keyword">var</span>\/zabbix_agentd.pid/<span class="keyword">g</span>' /usr/<span class="keyword">local</span>/zabbix_agentd/etc/zabbix_agentd.<span class="keyword">conf</span></span><br><span class="line">    check_ok</span><br><span class="line">    sudo sed -i 's/LogFile=\/tmp\/zabbix_agentd.<span class="keyword">log</span>/LogFile=\/usr\/<span class="keyword">local</span>\/zabbix_agentd\/<span class="keyword">var</span>\/zabbix_agentd.<span class="keyword">log</span>/<span class="keyword">g</span>' /usr/<span class="keyword">local</span>/zabbix_agentd/etc/zabbix_agentd.<span class="keyword">conf</span></span><br><span class="line">    check_ok</span><br><span class="line">    sudo sed -i 's/Server=127.0.0.1/Server=10.129.15.51/<span class="keyword">g</span>' /usr/<span class="keyword">local</span>/zabbix_agentd/etc/zabbix_agentd.<span class="keyword">conf</span></span><br><span class="line">    check_ok</span><br><span class="line">    sudo sed -i 's/^ServerActive=127.0.0.1/ServerActive=10.129.15.51/<span class="keyword">g</span>' /usr/<span class="keyword">local</span>/zabbix_agentd/etc/zabbix_agentd.<span class="keyword">conf</span></span><br><span class="line">    check_ok</span><br><span class="line">    sudo sed -i <span class="string">"s/Hostname=Zabbix server/Hostname=$&#123;HOSTNAME&#125;/g"</span> /usr/<span class="keyword">local</span>/zabbix_agentd/etc/zabbix_agentd.<span class="keyword">conf</span></span><br><span class="line">    check_ok</span><br><span class="line">    sudo sed -i '154s/.*/HostnameItem=system.hostname/' /usr/<span class="keyword">local</span>/zabbix_agentd/etc/zabbix_agentd.<span class="keyword">conf</span></span><br><span class="line">    check_ok</span><br><span class="line">    sudo <span class="keyword">mkdir</span> -p <span class="variable">$PREFIX</span>/<span class="keyword">var</span></span><br><span class="line">    check_ok</span><br><span class="line">    sudo groupadd zabbix</span><br><span class="line">    check_ok</span><br><span class="line">    sudo useradd -<span class="keyword">g</span> zabbix -<span class="keyword">M</span> -s /sbin/nologin zabbix</span><br><span class="line">    check_ok</span><br><span class="line">    <span class="keyword">cd</span> <span class="variable">$PREFIX</span></span><br><span class="line">    check_ok</span><br><span class="line">    sudo chown -R zabbix.zabbix <span class="keyword">var</span>/</span><br><span class="line">    check_ok</span><br><span class="line">    sudo /etc/init.<span class="keyword">d</span>/zabbix_agentd start</span><br><span class="line">    check_ok</span><br><span class="line">&#125;</span><br><span class="line">sudo ps -ef | grep zabbix_agentd | grep -v grep &gt;&gt;/tmp/zabbix_tmp/<span class="keyword">error</span>.<span class="built_in">log</span></span><br><span class="line"><span class="keyword">if</span> [ $? -<span class="keyword">eq</span> 0 ]</span><br><span class="line">then</span><br><span class="line">    echo <span class="string">"start process..."</span></span><br><span class="line">    <span class="keyword">exit</span> 1</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    zabbix_agentd_install</span><br><span class="line">fi</span><br></pre></td></tr></table></figure></p><p>2、ansible-playbook的yaml文件<br><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">- hosts: test</span><br><span class="line">  remote_user: localadmin</span><br><span class="line">  tasks:</span><br><span class="line">  - name: create /tmp/zabbix_tmp dir</span><br><span class="line">    file: path=&#123;&#123; item &#125;&#125; <span class="attribute">state</span>=directory</span><br><span class="line">    with_items:</span><br><span class="line">    - /tmp/zabbix_tmp</span><br><span class="line">  - name: copy install_shell <span class="keyword">to</span> clien</span><br><span class="line">    copy: <span class="attribute">src</span>=/opt/software/install.sh <span class="attribute">dest</span>=/tmp/zabbix_tmp/install.sh <span class="attribute">mode</span>=0755</span><br><span class="line">  - name: sent tar package <span class="keyword">to</span> client</span><br><span class="line">    copy: <span class="attribute">src</span>=/opt/software/zabbix-3.4.12.tar.gz <span class="attribute">dest</span>=/tmp/zabbix_tmp/zabbix-3.4.12.tar.gz</span><br><span class="line">    notify: install shell</span><br><span class="line">  handlers:</span><br><span class="line">  - name: install shell</span><br><span class="line">    shell: /bin/bash /tmp/zabbix_tmp/install.sh</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
        <tags>
            
            <tag> Zabbix </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>随便聊</title>
      <link href="/2018/09/06/hello-world/"/>
      <url>/2018/09/06/hello-world/</url>
      <content type="html"><![CDATA[<p>总结个人工作中遇到的问题总结及学习，只是笔记，仅供参考！</p>]]></content>
      
      
    </entry>
    
  
  
</search>
